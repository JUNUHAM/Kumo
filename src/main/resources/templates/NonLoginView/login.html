<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>KUMO - 로그인</title>
    <script>
              // src/main/resources/static/js/header-logic.js

      document.addEventListener("DOMContentLoaded", function() {
          const html = document.documentElement;
          const body = document.body;
          const theme = localStorage.getItem('theme');

          // 1. 다크모드 확정 (body에도 클래스 추가)
          if (theme === 'dark') {
              body.classList.add('dark-mode');
          }

          // 2. 아까 강제로 칠했던 인라인 스타일 제거 (이제 CSS가 맡음)
          // (혹시 제거했을 때 깜빡이면 이 부분은 지우세요)
          setTimeout(() => {
             // html.style.removeProperty('background-color');
             // html.style.removeProperty('color');
          }, 100);

          // 3. 다크모드 버튼 클릭 이벤트
          const toggleBtn = document.getElementById('darkModeBtn');
          const icon = document.getElementById('darkModeIcon');

          // 아이콘 초기화
          if (theme === 'dark' && icon) icon.classList.replace('fa-sun', 'fa-moon');

          if (toggleBtn) {
              toggleBtn.addEventListener('click', () => {
                  const isDark = html.classList.toggle('dark-mode');
                  body.classList.toggle('dark-mode');

                  localStorage.setItem('theme', isDark ? 'dark' : 'light');

                  if(icon) icon.classList.replace(isDark ? 'fa-sun' : 'fa-moon', isDark ? 'fa-moon' : 'fa-sun');

                  // 클릭했을 때 반응속도를 위해 인라인 스타일 제어
                  if(isDark) {
                      html.style.setProperty('background-color', '#121212', 'important');
                  } else {
                      html.style.removeProperty('background-color');
                      html.style.backgroundColor = '#ffffff';
                  }
              });
          }

          // 4. 언어 드롭다운 이벤트
          const langBtn = document.getElementById('langBtn');
          const langMenu = document.getElementById('langMenu');

          if (langBtn && langMenu) {
              langBtn.onclick = (e) => {
                  e.stopPropagation();
                  langMenu.classList.toggle('show');
              };
              document.addEventListener('click', (e) => {
                  if (!langBtn.contains(e.target)) langMenu.classList.remove('show');
              });
          }
      });

      // 5. 언어 변경 함수 (전역 함수로 선언해야 th:onclick 등에서 찾을 수 있음)
      window.changeLang = function(lang) {
          const url = new URL(window.location.href);
          url.searchParams.set('lang', lang);
          window.location.href = url.toString();
      };
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link
      rel="stylesheet"
      th:href="@{/css/NonLoginFragments/NonLoginHeader.css}"
    />
    <link
      rel="stylesheet"
      th:href="@{/css/NonLoginFragments/NonLoginFooter.css}"
    />
    <link rel="stylesheet" th:href="@{/css/NonLogin/login.css}" />
  </head>
  <body>
    <div
      th:replace="~{NonLoginFragments/NonLoginHeader :: headerFragment}"
    ></div>

    <main class="login-container">
      <div class="login-box">
        <div class="login-header">
            <h1 th:text="#{login.title}">로그인</h1>
            <p th:text="#{login.subtitle}">회원에게는 더 다양한 혜택이 제공됩니다.</p>
        </div>

        <form id="form" th:action="@{/loginProc}" method="post">
            <div class="input-group">
                <label class="input-label" th:text="#{login.label.id}">아이디</label>
                <input type="text" name="email" class="custom-input"
                       th:placeholder="#{login.placeholder.id}" required>
            </div>

            <div class="input-group">
                <label class="input-label" th:text="#{login.label.pw}">비밀번호</label>
                <input type="password" name="password" class="custom-input"
                       th:placeholder="#{login.placeholder.pw}" required>
            </div>

            <div class="options-row">
                <label class="checkbox-container" for="saveId">
                    <input type="checkbox" id="saveId">
                    <span th:text="#{login.save.id}">아이디 저장</span>
                </label>

                <div class="find-links">
                    <a th:href="@{/FindId}" class="forgot-id" th:text="#{login.forgot.id}">아이디 찾기</a>
                    <span class="separator" style="color: #ccc; margin: 0 5px;">|</span>
                    <a th:href="@{/FindPw}" class="forgot-pw" th:text="#{login.forgot.pw}">비밀번호 찾기</a>
                </div>
            </div>

            <div id="login-error-container" class="login-error-msg"
                 th:style="${param.error} ? 'display: flex;' : 'display: none;'">
                <i class="fa-solid fa-circle-exclamation"></i>
                <span id="login-error-text" th:text="#{login.error.fail}">아이디 또는 비밀번호가 일치하지 않습니다.</span>
            </div>

            <div id="captchaArea" style="display: none; margin-bottom: 20px; justify-content: center; width: 100%;">
                <div class="g-recaptcha" th:data-sitekey="${@environment.getProperty('google.recaptcha.site-key')}"></div>
            </div>

            <button type="submit" class="btn-login" th:text="#{login.btn.submit}">로그인</button>
        </form>

        <button type="button" class="social-btn" onclick="alertSns()">
            <img th:src="@{/images/NonLogin/googleLogo.svg}" class="social-icon" alt="Google">
            <span th:text="#{login.btn.google}">Google로 연결</span>
        </button>
        <button type="button" class="social-btn" onclick="alertSns()">
            <img th:src="@{/images/NonLogin/lineLogo.svg}" class="social-icon2" alt="Line">
            <span th:text="#{login.btn.line}">LINE으로 연결</span>
        </button>

        <div class="signup-link">
            <span th:text="#{login.not.member}">회원이 아니신가요?</span>
            <a th:href="@{/join}" th:text="#{login.signup}">회원가입</a>
        </div>
    </div>
</main>

<div th:replace="~{NonLoginFragments/NonLoginFooter :: footerFragment}"></div>

<script th:inline="javascript">
    const loginMessages = {
        sns_alert: [[#{login.sns.alert}]]
    };
</script>
<script th:src="@{/js/NonLogin/login.js}"></script>

</body>
</html>