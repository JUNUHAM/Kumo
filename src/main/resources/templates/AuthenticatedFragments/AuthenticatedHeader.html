<div th:fragment="headerFragment">
  <script th:inline="javascript">
      /* <![CDATA[ */

    // [1] 깜빡임 방지 (DOM 로드 전 즉시 실행)
    (function() {
      if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
      }

      const theme = localStorage.getItem('theme');
      if (theme === 'dark') {
        document.documentElement.classList.add('dark-mode');
        document.write(`
          <style id="page-transition-style">
            html { background-color: #121212 !important; }
            body { opacity: 0 !important; visibility: hidden !important; }
          </style>
        `);
      }
    })();

    // [2] 로딩 완료 후 기능 연결
    document.addEventListener("DOMContentLoaded", function() {
      const body = document.body;
      const html = document.documentElement;
      const theme = localStorage.getItem('theme');

      // 다크모드 클래스 확정
      if (theme === 'dark') {
          body.classList.add('dark-mode');
      }

      // 화면 표시 애니메이션
      requestAnimationFrame(() => {
        window.scrollTo(0, 0);
        body.style.opacity = '1';
        body.style.visibility = 'visible';

        setTimeout(() => {
          const styleTag = document.getElementById('page-transition-style');
          if (styleTag) styleTag.remove();
        }, 50);
      });

      // 다크모드 토글 버튼
      const toggleBtn = document.getElementById('darkModeBtn');
      const icon = document.getElementById('darkModeIcon');

      if (theme === 'dark' && icon) icon.classList.replace('fa-sun', 'fa-moon');

      if (toggleBtn) {
        toggleBtn.addEventListener('click', () => {
          const isDark = body.classList.toggle('dark-mode');
          html.classList.toggle('dark-mode');

          localStorage.setItem('theme', isDark ? 'dark' : 'light');

          if(icon) icon.classList.replace(isDark ? 'fa-sun' : 'fa-moon', isDark ? 'fa-moon' : 'fa-sun');

          html.style.backgroundColor = isDark ? '#121212' : '#ffffff';
        });
      }

      // 드롭다운 메뉴 (언어 선택 등)
      function setupMenu(btnId, menuId) {
        const btn = document.getElementById(btnId);
        const menu = document.getElementById(menuId);
        if (btn && menu) {
          btn.onclick = (e) => { e.stopPropagation(); menu.classList.toggle('show'); };
          document.addEventListener('click', (e) => { if (!btn.contains(e.target)) menu.classList.remove('show'); });
        }
      }

      setupMenu('langBtn', 'langMenu');
    });

    // 언어 변경 함수
    function changeLang(lang) {
        const url = new URL(window.location.href);
        url.searchParams.set('lang', lang);
        window.location.href = url.toString();
    }
    /* ]]> */
  </script>

  <header class="authenticated-header">
    <a th:href="@{/}" class="logo">
      <img
        th:src="@{/images/NonLogin/seekerLogo.png}"
        alt="KUMO"
        style="height: 40px;"
      />
    </a>

    <nav>
      <ul class="nav-menu">
        <li>
          <a th:href="@{/Info}" th:text="#{header.company}">회사 정보</a>
        </li>
        <li>
          <a th:href="@{/MyAccount}" th:text="#{header.account}">내 계정</a>
        </li>

        <li>
          <a th:href="@{/logout}" th:text="#{header.logout}">로그아웃</a>
        </li>

        <li class="icon-btn lang-container" id="langBtn">
          <i class="fa-solid fa-globe"></i>
          <div class="lang-dropdown" id="langMenu">
            <a href="javascript:changeLang('ko')" class="lang-item">한국어</a>
            <a href="javascript:changeLang('ja')" class="lang-item">日本語</a>
          </div>
        </li>

        <li class="icon-btn" id="darkModeBtn">
          <i class="fa-regular fa-sun" id="darkModeIcon"></i>
        </li>
      </ul>
    </nav>
  </header>
</div>