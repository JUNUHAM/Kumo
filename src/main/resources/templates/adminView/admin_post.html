<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>KUMO Admin - Post</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/adminView/admin_post.css}">
    <link rel="stylesheet" th:href="@{/css/adminView/admin_sidebar.css}">
    <style>
        /* ê²€ìƒ‰ í¼ ë ˆì´ì•„ì›ƒ ë³´ì • */
        .top-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        .search-box { flex: 2; }
        .filter-select { flex: 0 0 auto; }
        .btn-search {
            height: 42px;
            padding: 0 20px;
            white-space: nowrap;
        }

        /* [ì¶”ê°€] ëª¨ë‹¬ì°½ìš© CSS */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); z-index: 2000;
            display: flex; align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; padding: 30px; border-radius: 12px;
            width: 320px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .modal-content h3 { margin-top: 0; margin-bottom: 20px; color: #343a40; font-size: 18px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: #495057; }
        .form-group select { width: 100%; height: 42px; border-radius: 6px; border: 1px solid #ced4da; padding: 0 10px; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 25px; }

        /* ëª¨ë‹¬ ì·¨ì†Œ ë²„íŠ¼ ë“± ë³´ì¡° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-outline { background-color: white; color: #343a40; border: 1px solid #ddd; height: 42px; padding: 0 20px; border-radius: 8px; cursor: pointer; }
        .btn-outline:hover { background-color: #f1f3f5; }
    </style>
</head>
<body>

<aside th:replace="~{adminView/admin_sidebar :: admin_sidebar('post', ${lang})}"></aside>

<main class="main-content">

    <form action="/admin/post" method="get" class="top-controls">
        <input type="hidden" name="lang" th:value="${lang}">

        <select name="searchType" class="filter-select">
            <option value="title" th:selected="${searchType == 'title'}"
                    th:text="${lang == 'ja' ? 'ã‚¿ã‚¤ãƒˆãƒ«' : 'ê³µê³  ì œëª©'}">ê³µê³  ì œëª©</option>
            <option value="region" th:selected="${searchType == 'region'}"
                    th:text="${lang == 'ja' ? 'åœ°åŸŸ' : 'ì§€ì—­'}">ì§€ì—­</option>
        </select>

        <div class="search-box">
            <span class="search-icon">ğŸ”</span>
            <input type="text" name="keyword" class="search-input"
                   th:value="${keyword}"
                   th:placeholder="${lang == 'ja' ? 'æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›' : 'ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”'}">
        </div>

        <select name="status" class="filter-select">
            <option value="" th:selected="${status == null || status == ''}"
                    th:text="${lang == 'ja' ? 'å…¨çŠ¶æ…‹' : 'ì „ì²´ ìƒíƒœ'}">ì „ì²´ ìƒíƒœ</option>
            <option value="RECRUITING" th:selected="${status == 'RECRUITING'}"
                    th:text="${lang == 'ja' ? 'æ‰¿èªæ¸ˆã¿' : 'ìŠ¹ì¸ë¨'}">ìŠ¹ì¸ë¨</option>
            <option value="CLOSED" th:selected="${status == 'CLOSED'}"
                    th:text="${lang == 'ja' ? 'ç· ã‚åˆ‡ã‚Š' : 'ë§ˆê°ë¨'}">ë§ˆê°ë¨</option>
        </select>

        <button type="submit" class="btn btn-dark btn-search"
                th:text="${lang == 'ja' ? 'æ¤œç´¢' : 'ê²€ìƒ‰'}">ê²€ìƒ‰</button>
    </form>

    <div class="tab-menu">
        <div id="tab-btn-all" class="tab-item active" onclick="switchTab('all')"
             th:text="${lang == 'ja' ? 'å…¨æ±‚äºº' : 'ì „ì²´ ê³µê³ '}">ì „ì²´ ê³µê³ </div>
        <div id="tab-btn-report" class="tab-item" onclick="switchTab('report')"
             th:text="${lang == 'ja' ? 'ç”³å‘Š/é®æ–­' : 'ì‹ ê³  / ì°¨ë‹¨'}">ì‹ ê³  / ì°¨ë‹¨</div>
    </div>

    <div class="action-buttons">
        <button class="btn btn-dark" onclick="deleteSelectedItems()" th:text="${lang == 'ja' ? 'ğŸ—‘ï¸ å‰Šé™¤' : 'ğŸ—‘ï¸ ì‚­ì œ'}">ğŸ—‘ï¸ ì‚­ì œ</button>
    </div>

    <div id="tab-content-all" class="tab-content active">
        <div class="table-container">
            <table class="custom-table">
                <thead>
                <tr>
                    <th class="col-check">
                        <input type="checkbox" id="checkAllPosts" onclick="toggleAll('postIds', this.checked)">
                    </th>
                    <th class="col-title" th:text="${lang == 'ja' ? 'æ±‚äººæƒ…å ±' : 'ê³µê³  ì •ë³´'}">ê³µê³  ì •ë³´</th>
                    <th class="col-cate" th:text="${lang == 'ja' ? 'ã‚«ãƒ†ã‚´ãƒª' : 'ì¹´í…Œê³ ë¦¬'}">ì¹´í…Œê³ ë¦¬</th>
                    <th class="col-date1" th:text="${lang == 'ja' ? 'ç™»éŒ²æ—¥' : 'ë“±ë¡ì¼'}">ë“±ë¡ì¼</th>
                    <th class="col-date2" th:text="${lang == 'ja' ? 'åœ°åŸŸ' : 'ì§€ì—­'}">ì§€ì—­</th>
                    <th class="col-status" th:text="${lang == 'ja' ? 'çŠ¶æ…‹' : 'ìƒíƒœ'}">ìƒíƒœ</th>
                    <th class="col-manage" th:text="${lang == 'ja' ? 'ç®¡ç†' : 'ê´€ë¦¬'}">ê´€ë¦¬</th>
                </tr>
                </thead>

                <tbody>
                <tr th:if="${posts.totalElements == 0}">
                    <td colspan="7" style="padding: 50px 0; color: #999; text-align: center;"
                        th:text="${lang == 'ja' ? 'æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚' : 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'}">
                        ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                    </td>
                </tr>

                <tr th:each="post : ${posts.content}">
                    <td>
                        <input type="checkbox" name="postIds" th:value="${post.source + '_' + post.id}">
                    </td>

                    <td class="col-title">
                        <a class="title-link"
                           th:href="@{/map/jobs/detail(id=${post.id}, source=${post.source}, lang=${lang})}"
                           target="_blank">
                            <span class="title-text" th:text="${post.title}" th:title="${post.title}">ì œëª©</span>
                        </a>
                    </td>

                    <td class="col-cate" th:text="${post.position}">ì§ë¬´</td>

                    <td th:text="${post.createdAt != null ? #temporals.format(post.createdAt, 'yyyy.MM.dd') : '-'}">ë‚ ì§œ</td>

                    <td>
                        <span th:text="${#strings.contains(post.source, 'OSAKA') ? (lang == 'ja' ? 'å¤§é˜ª' : 'ì˜¤ì‚¬ì¹´') : (lang == 'ja' ? 'æ±äº¬' : 'ë„ì¿„')}">
                            ì§€ì—­
                        </span>
                    </td>

                    <td>
                        <span class="badge"
                              th:classappend="${post.status == 'CLOSED' ? 'badge-red' : 'badge-green'}"
                              th:text="${post.status == 'CLOSED' ? (lang == 'ja' ? 'ç· ã‚åˆ‡ã‚Š' : 'ë§ˆê°ë¨') : (lang == 'ja' ? 'æ‰¿èªæ¸ˆã¿' : 'ìŠ¹ì¸ë¨')}">
                            ìƒíƒœ
                        </span>
                    </td>

                    <td>
                        <span class="action-link edit" style="cursor: pointer;"
                              th:onclick="openEditModal([[${post.source}]], [[${post.id}]], [[${post.status}]])"
                              th:text="${lang == 'ja' ? 'ä¿®æ­£' : 'ìˆ˜ì •'}">ìˆ˜ì •</span>

                        <span class="action-link delete" style="cursor: pointer;"
                              th:onclick="deleteOnePost([[${post.source}]], [[${post.id}]])"
                              th:text="${lang == 'ja' ? 'å‰Šé™¤' : 'ì‚­ì œ'}">ì‚­ì œ</span>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="pagination-container" th:if="${posts.totalElements > 0}">
                <ul class="pagination">

                    <li th:classappend="${posts.first} ? 'disabled'">
                        <a th:href="@{/admin/post(page=0, lang=${lang}, searchType=${searchType}, keyword=${keyword}, status=${status})}">&laquo;&laquo;</a>
                    </li>

                    <li th:classappend="${posts.first} ? 'disabled'">
                        <a th:href="@{/admin/post(page=${posts.number - 1}, lang=${lang}, searchType=${searchType}, keyword=${keyword}, status=${status})}">&lsaquo;</a>
                    </li>

                    <li th:each="pageNum : ${#numbers.sequence(startPage, endPage)}"
                        th:classappend="${pageNum == posts.number + 1} ? 'active'">
                        <a th:href="@{/admin/post(page=${pageNum - 1}, lang=${lang}, searchType=${searchType}, keyword=${keyword}, status=${status})}"
                           th:text="${pageNum}">1</a>
                    </li>

                    <li th:classappend="${posts.last} ? 'disabled'">
                        <a th:href="@{/admin/post(page=${posts.number + 1}, lang=${lang}, searchType=${searchType}, keyword=${keyword}, status=${status})}">&rsaquo;</a>
                    </li>

                    <li th:classappend="${posts.last} ? 'disabled'">
                        <a th:href="@{/admin/post(page=${totalPages - 1}, lang=${lang}, searchType=${searchType}, keyword=${keyword}, status=${status})}">&raquo;&raquo;</a>
                    </li>

                </ul>
            </div>
        </div>
    </div>

    <div id="tab-content-report" class="tab-content">
        <div class="table-container">
            <table class="custom-table">
                <thead>
                <tr>
                    <th class="col-check"><input type="checkbox" id="checkAllReports" onclick="toggleAll('reportIds', this.checked)"></th>
                    <th class="col-title" th:text="${lang == 'ja' ? 'æ±‚äººã‚¿ã‚¤ãƒˆãƒ«' : 'ê³µê³  ì œëª©'}">ê³µê³  ì œëª©</th>
                    <th class="col-cate" th:text="${lang == 'ja' ? 'ç”³å‘Šè€…' : 'ì‹ ê³ ì'}">ì‹ ê³ ì</th>
                    <th class="col-date1" th:text="${lang == 'ja' ? 'ç™»éŒ²æ—¥' : 'ë“±ë¡ì¼'}">ë“±ë¡ì¼</th>
                    <th class="col-date2" th:text="${lang == 'ja' ? 'äº‹ç”±' : 'ì‚¬ìœ '}">ì‚¬ìœ </th>
                    <th class="col-status" th:text="${lang == 'ja' ? 'çŠ¶æ…‹' : 'ìƒíƒœ'}">ìƒíƒœ</th>
                    <th class="col-manage" th:text="${lang == 'ja' ? 'ç®¡ç†' : 'ê´€ë¦¬'}">ê´€ë¦¬</th>
                </tr>
                </thead>
                <tbody>

                <tr th:if="${#lists.isEmpty(reports)}">
                    <td colspan="7" style="text-align: center; padding: 50px; color: #999;" th:text="${lang == 'ja' ? 'ç”³å‘Šå†…è¨³ãŒã‚ã‚Šã¾ã›ã‚“ã€‚' : 'ì‹ ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.'}">ì‹ ê³  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>

                <tr th:each="report : ${reports}">
                    <td><input type="checkbox" name="reportIds" th:value="${report.reportId}"></td>
                    <td class="col-title">
                        <a class="title-link" th:href="@{/map/jobs/detail(id=${report.targetPostId}, source=${report.targetSource}, lang=${lang})}" target="_blank">
                            <span class="title-text" th:text="${report.targetPostTitle}">ì œëª©</span>
                        </a>
                    </td>
                    <td class="col-cate" th:text="${report.reporterEmail}">ì´ë©”ì¼</td>
                    <td th:text="${#temporals.format(report.createdAt, 'yyyy.MM.dd')}">ë‚ ì§œ</td>
                    <td class="col-date2" th:text="${report.reasonCategory}">ì‚¬ìœ </td>
                    <td>
                        <span class="badge"
                              th:classappend="${report.status == 'PENDING' ? 'badge-grey' : (report.status == 'BLOCKED' ? 'badge-red' : 'badge-green')}"
                              th:text="${report.status == 'PENDING' ? (lang == 'ja' ? 'å¾…æ©Ÿä¸­' : 'ëŒ€ê¸°ì¤‘') : (report.status == 'BLOCKED' ? (lang == 'ja' ? 'é®æ–­æ¸ˆã¿' : 'ì°¨ë‹¨ë¨') : (lang == 'ja' ? 'å®Œäº†' : 'ì²˜ë¦¬ì™„ë£Œ'))}">ìƒíƒœ</span>
                    </td>
                    <td>
                        <button class="btn-detail" type="button"
                                th:onclick="openReportModal([[${report.reportId}]], [[${report.reporterEmail}]], [[${report.reasonCategory}]], [[${report.description}]], [[${report.status}]])"
                                th:text="${lang == 'ja' ? 'å†…å®¹ç¢ºèª' : 'ë‚´ìš© í™•ì¸'}">ë‚´ìš© í™•ì¸</button>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="pagination-container" th:if="${reports.totalElements > 0}">
                <ul class="pagination">
                    <li th:classappend="${reports.first} ? 'disabled'">
                        <a th:href="@{/admin/post(reportPage=0, lang=${lang}, tab='report')}">&laquo;&laquo;</a>
                    </li>
                    <li th:classappend="${reports.first} ? 'disabled'">
                        <a th:href="@{/admin/post(reportPage=${reports.number - 1}, lang=${lang}, tab='report')}">&lsaquo;</a>
                    </li>
                    <li th:each="pageNum : ${#numbers.sequence(reportStartPage, reportEndPage)}"
                        th:classappend="${pageNum == reports.number + 1} ? 'active'">
                        <a th:href="@{/admin/post(reportPage=${pageNum - 1}, lang=${lang}, tab='report')}"
                           th:text="${pageNum}">1</a>
                    </li>
                    <li th:classappend="${reports.last} ? 'disabled'">
                        <a th:href="@{/admin/post(reportPage=${reports.number + 1}, lang=${lang}, tab='report')}">&rsaquo;</a>
                    </li>
                    <li th:classappend="${reports.last} ? 'disabled'">
                        <a th:href="@{/admin/post(reportPage=${reportTotalPages - 1}, lang=${lang}, tab='report')}">&raquo;&raquo;</a>
                    </li>
                </ul>
            </div>

        </div>
    </div>
</main>

<div id="editPostModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3 th:text="${lang == 'ja' ? 'æ±‚äººçŠ¶æ…‹ã®å¤‰æ›´' : 'ê³µê³  ìƒíƒœ ë³€ê²½'}">ê³µê³  ìƒíƒœ ë³€ê²½</h3>

        <input type="hidden" id="editPostSource">
        <input type="hidden" id="editPostId">

        <div class="form-group">
            <label th:text="${lang == 'ja' ? 'çŠ¶æ…‹ (æ‰¿èª/ç· ã‚åˆ‡ã‚Š)' : 'ìƒíƒœ ì„¤ì • (ìŠ¹ì¸/ë§ˆê°)'}">ìƒíƒœ</label>
            <select id="editPostStatus">
                <option value="RECRUITING" th:text="${lang == 'ja' ? 'æ‰¿èªæ¸ˆã¿ (å‹Ÿé›†ä¸­)' : 'ìŠ¹ì¸ë¨ (ëª¨ì§‘ì¤‘)'}">ìŠ¹ì¸ë¨</option>
                <option value="CLOSED" th:text="${lang == 'ja' ? 'ç· ã‚åˆ‡ã‚Š' : 'ë§ˆê°ë¨'}">ë§ˆê°ë¨</option>
            </select>
        </div>

        <div class="modal-actions">
            <button class="btn-outline" onclick="closeEditModal()" th:text="${lang == 'ja' ? 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«' : 'ì·¨ì†Œ'}">ì·¨ì†Œ</button>
            <button class="btn-dark" onclick="submitEdit()" th:text="${lang == 'ja' ? 'ç¢ºèª' : 'í™•ì¸'}">í™•ì¸</button>
        </div>
    </div>
</div>

<div id="reportModal" class="modal-overlay" style="display: none;">
    <div class="report-modal-content">
        <h3 th:text="${lang == 'ja' ? 'ç”³å‘Šå†…å®¹ã®ç¢ºèª' : 'ì‹ ê³  ë‚´ìš© í™•ì¸'}">ì‹ ê³  ë‚´ìš© í™•ì¸</h3>

        <input type="hidden" id="reportIdVal">

        <div class="report-info-group">
            <span class="label" th:text="${lang == 'ja' ? 'ç”³å‘Šè€…' : 'ì‹ ê³ ì ì´ë©”ì¼'}">ì‹ ê³ ì ì´ë©”ì¼</span>
            <span class="value" id="reportEmailVal">user@email.com</span>
        </div>

        <div class="report-info-group">
            <span class="label" th:text="${lang == 'ja' ? 'ç”³å‘Šã‚«ãƒ†ã‚´ãƒª' : 'ì‹ ê³  ì¹´í…Œê³ ë¦¬'}">ì‹ ê³  ì¹´í…Œê³ ë¦¬</span>
            <span class="value" id="reportCategoryVal">ì¹´í…Œê³ ë¦¬ëª…</span>
        </div>

        <div class="form-group" style="margin-top: 20px;">
            <label th:text="${lang == 'ja' ? 'ç”³å‘Šå†…å®¹' : 'ì‹ ê³  ìƒì„¸ ë‚´ìš©'}">ì‹ ê³  ìƒì„¸ ë‚´ìš©</label>
            <div id="reportDescVal" class="report-desc-box">
                ì—¬ê¸°ì— ì‹ ê³  ë‚´ìš©ì´ ì¶œë ¥ë©ë‹ˆë‹¤.
            </div>
        </div>

        <div class="form-group">
            <label th:text="${lang == 'ja' ? 'ç”³å‘Šå‡¦ç†çŠ¶æ…‹' : 'ì‹ ê³  ì²˜ë¦¬ ìƒíƒœ'}">ì‹ ê³  ì²˜ë¦¬ ìƒíƒœ</label>
            <select id="reportStatusSelect">
                <option value="PENDING" th:text="${lang == 'ja' ? 'å¾…æ©Ÿä¸­' : 'ëŒ€ê¸°ì¤‘'}">ëŒ€ê¸°ì¤‘</option>
                <option value="CLOSED" th:text="${lang == 'ja' ? 'å‡¦ç†å®Œäº†' : 'ì²˜ë¦¬ì™„ë£Œ'}">ì²˜ë¦¬ì™„ë£Œ</option>
                <option value="BLOCKED" th:text="${lang == 'ja' ? 'é®æ–­æ¸ˆã¿' : 'ì°¨ë‹¨ë¨'}">ì°¨ë‹¨ë¨</option>
            </select>
        </div>

        <div class="modal-actions">
            <button class="btn-outline" onclick="closeReportModal()" th:text="${lang == 'ja' ? 'é–‰ã˜ã‚‹' : 'ë‹«ê¸°'}">ë‹«ê¸°</button>
            <button class="btn-dark" onclick="submitReportStatus()" th:text="${lang == 'ja' ? 'ä¿å­˜' : 'ìƒíƒœ ì €ì¥'}">ìƒíƒœ ì €ì¥</button>
        </div>
    </div>
</div>

<script th:inline="javascript">
    const currentLang = [[${lang}]] || 'ko';

    function changeLanguage(lang) {
        const url = new URL(window.location.href);
        url.searchParams.set('lang', lang);
        window.location.href = url.toString();
    }

    function switchTab(tabName) {
        document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-btn-' + tabName).classList.add('active');
        document.getElementById('tab-content-' + tabName).classList.add('active');
    }

    function toggleAll(name, isChecked) {
        document.querySelectorAll(`input[name="${name}"]`).forEach(cb => cb.checked = isChecked);
    }

    // ----------------------------------------------------
    // ê³µê³  ìˆ˜ì • ë¡œì§
    // ----------------------------------------------------
    function openEditModal(source, id, status) {
        document.getElementById('editPostSource').value = source;
        document.getElementById('editPostId').value = id;
        document.getElementById('editPostStatus').value = status || 'RECRUITING';
        document.getElementById('editPostModal').style.display = 'flex';
    }

    function closeEditModal() {
        document.getElementById('editPostModal').style.display = 'none';
    }

    function submitEdit() {
        const source = document.getElementById('editPostSource').value;
        const id = document.getElementById('editPostId').value;
        const status = document.getElementById('editPostStatus').value;

        const msg = currentLang === 'ja' ? "ä¿®æ­£ã—ã¾ã™ã‹ï¼Ÿ" : "ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
        if(confirm(msg)) {
            fetch('/admin/post/edit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ source: source, id: id, status: status })
            }).then(res => {
                if (res.ok) {
                    alert(currentLang === 'ja' ? "ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸã€‚" : "ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    location.reload();
                } else {
                    alert(currentLang === 'ja' ? "ä¿®æ­£ã«å¤±æ•—ã—ã¾ã—ãŸã€‚" : "ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            }).catch(error => {
                console.error('Error:', error);
                alert("Network Error");
            });

            closeEditModal();
        }
    }

    // ----------------------------------------------------
    // [ì¶”ê°€] ì‹ ê³  í™•ì¸ ë° ìƒíƒœ ë³€ê²½ ë¡œì§
    // ----------------------------------------------------
    function openReportModal(id, email, category, desc, status) {
        // ëª¨ë‹¬ì°½ì— ê°’ ì±„ìš°ê¸°
        document.getElementById('reportIdVal').value = id;
        document.getElementById('reportEmailVal').innerText = email;
        document.getElementById('reportCategoryVal').innerText = category;
        document.getElementById('reportDescVal').innerText = desc;
        document.getElementById('reportStatusSelect').value = status || 'PENDING';

        // ëª¨ë‹¬ ë„ìš°ê¸°
        document.getElementById('reportModal').style.display = 'flex';
    }

    function closeReportModal() {
        document.getElementById('reportModal').style.display = 'none';
    }

    // [ìˆ˜ì • ì™„ë£Œ] ì‹ ê³  ìƒíƒœ ìˆ˜ì • API ì—°ë™ ë° ë¶ˆí•„ìš”í•œ ë”ë¯¸ ì½”ë“œ ì œê±°
    function submitReportStatus() {
        const reportId = document.getElementById('reportIdVal').value;
        const newStatus = document.getElementById('reportStatusSelect').value;

        const msg = currentLang === 'ja' ? "ç”³å‘ŠçŠ¶æ…‹ã‚’å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ" : "ì‹ ê³  ìƒíƒœë¥¼ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
        if(confirm(msg)) {
            fetch('/admin/report/edit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: reportId, status: newStatus })
            }).then(res => {
                if(res.ok) {
                    alert(currentLang === 'ja' ? "å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸã€‚" : "ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    // ì²˜ë¦¬ ì™„ë£Œ í›„ ì‹ ê³  íƒ­ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©° ìƒˆë¡œê³ ì¹¨
                    const url = new URL(window.location.href);
                    url.searchParams.set('tab', 'report');
                    window.location.href = url.toString();
                } else {
                    alert(currentLang === 'ja' ? "å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸã€‚" : "ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            }).catch(error => {
                console.error('Error:', error);
                alert("Network Error");
            });

            closeReportModal();
        }
    }

    // ----------------------------------------------------
    // ì‚­ì œ ë¡œì§
    // ----------------------------------------------------
    function deleteOnePost(source, id) {
        const msg = currentLang === 'ja' ? "æœ¬å½“ã«ã“ã®æ±‚äººã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" : "ì •ë§ ì´ ê³µê³ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
        if(!confirm(msg)) return;

        fetch('/admin/post/delete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ids: [source + "_" + id] })
        }).then(res => {
            if (res.ok) { location.reload(); }
            else { alert(currentLang === 'ja' ? "å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚" : "ì‚­ì œ ì‹¤íŒ¨"); }
        });
    }

    function deleteSelectedItems() {
        const isReportTab = document.getElementById('tab-content-report').classList.contains('active');
        const targetName = isReportTab ? 'reportIds' : 'postIds';
        const checkedBoxes = document.querySelectorAll(`input[name="${targetName}"]:checked`);

        if (checkedBoxes.length === 0) {
            alert(currentLang === 'ja' ? "å‰Šé™¤ã™ã‚‹é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚" : "ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        const ids = Array.from(checkedBoxes).map(cb => isReportTab ? parseInt(cb.value) : cb.value);
        if (!confirm(currentLang === 'ja' ? "é¸æŠã—ãŸé …ç›®ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" : "ì„ íƒí•œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        fetch(isReportTab ? '/admin/report/delete' : '/admin/post/delete', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ids: ids })
        }).then(res => {
            if (res.ok) { location.reload(); }
            else { alert("Error"); }
        });
    }
</script>
</body>
</html>