<!doctype html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <div th:fragment="headerFragment">
    <script th:inline="javascript">
      /* <![CDATA[ */
      (function() {
        // 1. 깜빡임 방지: CSS보다 빠르게 배경색 선제 타격
        const theme = localStorage.getItem('theme');
        if (theme === 'dark') {
          document.documentElement.classList.add('dark-mode');
          // CSS 로드 전 0.1초의 공백을 메꾸는 긴급 스타일
          document.write('<style id="anti-flash">html, body { background-color: #1a1a1b !important; color: #e2e8f0 !important; }</style>');
        }

        // 2. 다국어 메시지 전역 설정: 모든 JS 파일에서 공유
        window.kumoMsgs = {
          scheduleTitle: /*[[#{main.calendar.schedule_detail}]]*/ ' 일정',
          noSchedule: /*[[#{main.calendar.no_schedule}]]*/ '일정이 없습니다.'
        };
      })();
      /* ]]> */
    </script>
    <header class="non-login-header">
      <div class="logo">
        <a th:href="@{/Recruiter/Main}">
          <img
            th:src="@{/images/recruiter/recruiterLogo.png}"
            alt="KUMO"
            style="height: 35px;"
          />
        </a>
      </div>

      <ul class="nav-menu">
        <li><a th:href="@{/info}" th:text="#{header.company}">회사 정보</a></li>

        <li sec:authorize="isAnonymous()">
          <a th:href="@{/login}" th:text="#{header.login}">로그인</a>
        </li>

        <li sec:authorize="isAuthenticated()">
          <a th:href="@{/recruiter/profile}" th:text="#{header.mypage}"
            >마이페이지</a
          >
        </li>

        <li class="icon-btn lang-container" id="langBtn">
          <i class="fa-solid fa-globe"></i>
          <div class="lang-dropdown" id="langMenu">
            <a href="javascript:changeLang('ko')" class="lang-item">한국어</a>
            <a href="javascript:changeLang('ja')" class="lang-item">日本語</a>
          </div>
        </li>

        <li class="icon-btn" id="darkModeBtn">
          <i class="fa-regular fa-sun" id="darkModeIcon"></i>
        </li>
      </ul>
    </header>

    <script th:inline="javascript">
      /* <![CDATA[ */
      document.addEventListener("DOMContentLoaded", function() {
          // [다크모드 로직]
          const toggleBtn = document.getElementById('darkModeBtn');
          const icon = document.getElementById('darkModeIcon');
          const body = document.body;
          const currentTheme = localStorage.getItem('theme');

          if (currentTheme === 'dark') {
              body.classList.add('dark-mode');
              if(icon) {
                  icon.classList.replace('fa-sun', 'fa-moon');
              }
          }

          if (toggleBtn) {
              toggleBtn.addEventListener('click', () => {
                  body.classList.toggle('dark-mode');
                  if (body.classList.contains('dark-mode')) {
                      localStorage.setItem('theme', 'dark');
                      if(icon) { icon.classList.remove('fa-sun'); icon.classList.add('fa-moon'); }
                  } else {
                      localStorage.setItem('theme', 'light');
                      if(icon) { icon.classList.remove('fa-moon'); icon.classList.add('fa-sun'); }
                  }
              });
          }

          // [언어 드롭다운 로직]
          const langBtn = document.getElementById('langBtn');
          const langMenu = document.getElementById('langMenu');

          if (langBtn && langMenu) {
              langBtn.addEventListener('click', (e) => {
                  e.stopPropagation();
                  langMenu.classList.toggle('show');
              });

              document.addEventListener('click', (e) => {
                  if (!langBtn.contains(e.target)) {
                      langMenu.classList.remove('show');
                  }
              });
          }
      });

      function changeLang(lang) {
          const url = new URL(window.location.href);
          url.searchParams.set('lang', lang);
          window.location.href = url.toString();
      }
      /* ]]> */
    </script>
  </div>
</html>
