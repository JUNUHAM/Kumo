<!doctype html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <div th:fragment="headerFragment">
    <script th:inline="javascript">
      /* <![CDATA[ */
      // 1. [커튼 치기] 페이지가 열리자마자 실행
      (function() {
        const theme = localStorage.getItem('theme');
        if (theme === 'dark') {
          // html 태그에 다크모드 명찰 부착
          document.documentElement.classList.add('dark-mode');

          // 브라우저에게 "일단 아무것도 보여주지 마(투명하게)" + "배경은 검게 칠해놔" 라고 명령
          document.write(`
            <style id="dark-curtain">
              html { background-color: #121212 !important; }
              body {
                visibility: hidden !important;
                opacity: 0 !important;
                transition: opacity 0.3s ease; /* 부드럽게 등장하는 효과 */
              }
            </style>
          `);
        }

        // 전역 메시지 설정
        window.kumoMsgs = {
          scheduleTitle: /*[[#{main.calendar.schedule_detail}]]*/ ' 일정',
          noSchedule: /*[[#{main.calendar.no_schedule}]]*/ '일정이 없습니다.'
        };
      })();

      // 2. [커튼 열기] 모든 로딩이 끝나면 실행
      document.addEventListener("DOMContentLoaded", function() {
          const body = document.body;
          const html = document.documentElement;
          const theme = localStorage.getItem('theme');

          // 다크모드라면 body에도 클래스 확실히 주입
          if (theme === 'dark') {
              body.classList.add('dark-mode');

              // 브라우저가 색칠할 시간을 아주 조금(프레임 1장) 줍니다.
              requestAnimationFrame(() => {
                  // 커튼 스타일 태그 제거 (이제 보여도 된다!)
                  const curtain = document.getElementById('dark-curtain');
                  if (curtain) curtain.remove();

                  // 투명도 0 -> 1 (짜잔! 하고 등장)
                  body.style.visibility = 'visible';
                  body.style.opacity = '1';
              });
          }

          // --- [토글 버튼 로직] ---
          const toggleBtn = document.getElementById('darkModeBtn');
          const icon = document.getElementById('darkModeIcon');

          // 아이콘 초기화
          if (theme === 'dark' && icon) icon.classList.replace('fa-sun', 'fa-moon');

          if (toggleBtn) {
              toggleBtn.addEventListener('click', () => {
                  // 혹시 모를 커튼 잔재 제거
                  const curtain = document.getElementById('dark-curtain');
                  if(curtain) curtain.remove();

                  const isDark = body.classList.toggle('dark-mode');
                  html.classList.toggle('dark-mode');

                  if (isDark) {
                      localStorage.setItem('theme', 'dark');
                      if(icon) icon.classList.replace('fa-sun', 'fa-moon');
                  } else {
                      localStorage.setItem('theme', 'light');
                      if(icon) icon.classList.replace('fa-moon', 'fa-sun');

                      // 라이트모드 전환 시 강제 리셋 (배경색 찌꺼기 제거)
                      body.style.backgroundColor = '';
                      body.style.opacity = '1';
                      body.style.visibility = 'visible';
                  }
              });
          }

          // --- [언어 드롭다운] ---
          const langBtn = document.getElementById('langBtn');
          const langMenu = document.getElementById('langMenu');
          if (langBtn && langMenu) {
              langBtn.onclick = (e) => { e.stopPropagation(); langMenu.classList.toggle('show'); };
              document.addEventListener('click', (e) => { if (!langBtn.contains(e.target)) langMenu.classList.remove('show'); });
          }

          // --- [프로필 팝업] ---
          const profileBtn = document.getElementById('profileBtn');
          const profilePopup = document.getElementById('profilePopup');
          if (profileBtn && profilePopup) {
              profileBtn.onclick = (e) => { e.stopPropagation(); profilePopup.classList.toggle('show'); };
              document.addEventListener('click', (e) => { if (!profileBtn.contains(e.target)) profilePopup.classList.remove('show'); });
          }
      });

      function changeLang(lang) {
          const url = new URL(window.location.href);
          url.searchParams.set('lang', lang);
          window.location.href = url.toString();
      }
      /* ]]> */
    </script>
    <header class="non-login-header">
      <div class="logo">
        <a th:href="@{/Recruiter/Main}">
          <img
            th:src="@{/images/recruiter/recruiterLogo.png}"
            alt="KUMO"
            style="height: 35px;"
          />
        </a>
      </div>

      <ul class="nav-menu">
        <li class="icon-btn">
          <i class="fa-regular fa-bell"></i>
        </li>

        <li class="icon-btn lang-container" id="langBtn">
          <i class="fa-solid fa-globe"></i>
          <div class="lang-dropdown" id="langMenu">
            <a href="javascript:changeLang('ko')" class="lang-item">한국어</a>
            <a href="javascript:changeLang('ja')" class="lang-item">日本語</a>
          </div>
        </li>

        <li class="icon-btn" id="darkModeBtn">
          <i class="fa-regular fa-sun" id="darkModeIcon"></i>
        </li>

        <li class="profile-container" id="profileBtn">
          <div class="profile-circle">
            <img
              th:src="@{/images/recruiter/default-profile.png}"
              alt="Profile"
            />
          </div>

          <div class="profile-popup" id="profilePopup">
            <div class="popup-arrow"></div>
            <div class="user-info">
              <h3 th:text="${#authentication.name}"></h3>
            </div>
            <div class="popup-buttons">
              <a th:href="@{/Recruiter/MyAccount}" class="btn-edit-profile"
                >내 프로필 편집</a
              >
              <a th:href="@{/Recruiter/CompanyInfo}" class="btn-edit-profile"
                >회사 정보 편집</a
              >s
              <form th:action="@{/logout}" method="post">
                <button type="submit" class="btn-logout">로그아웃</button>
              </form>
            </div>
          </div>
        </li>
      </ul>
    </header>
  </div>
</html>
