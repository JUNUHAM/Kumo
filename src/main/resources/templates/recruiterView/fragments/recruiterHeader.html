<!doctype html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <div th:fragment="headerFragment">
    <header class="authenticated-header">
      <link
        rel="stylesheet"
        th:href="@{/css/RecruiterFragments/RecruiterHeader.css}"
        sec:authorize="isAuthenticated()"
      />

      <a th:href="@{/Recruiter/Main}" class="logo">
        <img
          th:src="@{/images/recruiter/recruiterLogo.png}"
          alt="KUMO"
          style="height: 40px;"
        />
      </a>

      <nav>
        <ul class="nav-menu">
          <li class="icon-btn notification-container" id="notifyBtn">
            <i class="fa-regular fa-bell"></i>
            <span class="notify-badge" style="display: none;">0</span>

            <div class="notify-dropdown" id="notifyMenu">
              <div class="notify-header">
                <span th:text="#{header.notifications}">ì•Œë¦¼</span>
                <div class="header-buttons">
                  <button
                    class="header-btn read-all"
                    id="markAllReadBtn"
                    th:text="#{header.mark_read}"
                  >
                    ëª¨ë‘ ì½ìŒ
                  </button>
                  <span class="divider">|</span>
                  <button
                    class="header-btn delete-all"
                    id="deleteAllBtn"
                    th:text="#{header.delete_all}"
                  >
                    ì „ì²´ ì‚­ì œ
                  </button>
                </div>
              </div>

              <div class="notify-body" id="notifyList">
                <div
                  class="notify-empty"
                  id="notifyEmpty"
                  style="display: none;"
                >
                  <i class="fa-regular fa-bell-slash"></i>
                  <p th:text="#{notification.empty}">ìƒˆë¡œìš´ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
              </div>

              <div
                class="notify-footer"
                id="expandBtn"
                th:data-more="#{notification.more}"
                th:data-fold="#{notification.fold}"
              >
                <span th:text="#{notification.more}">ë” ë³´ê¸°</span>
                <i class="fa-solid fa-chevron-down"></i>
              </div>
            </div>
          </li>

          <li class="icon-btn lang-container" id="langBtn">
            <i class="fa-solid fa-globe"></i>
            <div class="lang-dropdown" id="langMenu">
              <a href="javascript:changeLang('ko')" class="lang-item">í•œêµ­ì–´</a>
              <a href="javascript:changeLang('ja')" class="lang-item">æ—¥æœ¬èª</a>
            </div>
          </li>

          <li class="icon-btn" id="darkModeBtn">
            <i class="fa-regular fa-sun" id="darkModeIcon"></i>
          </li>

          <li class="profile-container" id="profileBtn">
            <div class="profile-circle">
              <img
                th:src="${user?.profileImage}"
                alt="Profile"
                class="user-avatar"
                id="profilePreview"
                th:if="${user?.profileImage != null}"
              />
              <i
                class="bi bi-person-circle"
                id="defaultIcon"
                th:unless="${user?.profileImage != null}"
              ></i>
            </div>

            <div class="profile-dropdown" id="profileMenu">
              <div class="profile-info">
                <span
                  class="user-name"
                  th:text="${#authentication.principal.nickname}"
                  >User</span
                >
                <span class="user-email" th:text="${#authentication.name}"
                  >email@test.com</span
                >
              </div>
              <hr />
              <a th:href="@{/Recruiter/MyPage}" class="profile-item">
                <i class="fa-regular fa-user"></i>
                <span th:text="#{profile.mypage}">ë§ˆì´í˜ì´ì§€</span>
              </a>
              <a th:href="@{/Recruiter/Settings}" class="profile-item">
                <i class="fa-solid fa-gear"></i>
                <span th:text="#{profile.settings}">ì„¤ì •</span>
              </a>
              <hr />
              <a th:href="@{/logout}" class="profile-item logout">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span th:text="#{profile.logout}">ë¡œê·¸ì•„ì›ƒ</span>
              </a>
            </div>
          </li>
        </ul>
      </nav>
    </header>

    <!-- ============================================================
         ë‹¤í¬ëª¨ë“œ ê¹œë¹¡ì„ ë°©ì§€ ìŠ¤í¬ë¦½íŠ¸ (ì¸ë¼ì¸ ìœ ì§€ í•„ìˆ˜)
         ============================================================ -->
    <script th:inline="javascript">
      /* <![CDATA[ */
        (function () {
          if ('scrollRestoration' in history) history.scrollRestoration = 'manual';

          const theme = localStorage.getItem('theme');
          if (theme === 'dark') {
            const root = document.documentElement;
            root.classList.add('dark-mode');

            // ğŸŒŸ [ê°œì„ ] í—¤ë”ëŠ” ì‚´ë¦¬ê³  ë‚˜ë¨¸ì§€ë§Œ ìˆ¨ê¸°ëŠ” ìŠ¤íƒ€ì¼ ì£¼ì…
            document.write(
              '<style id="anti-flicker-css">' +
              '  *:not(.no-prevent-transition) { transition: none !important; }' +
              '  html, body { background-color: #121212 !important; color: #FFFFFF !important; margin: 0; padding: 0; }' +

              // ğŸŒŸ [í¬ì¸íŠ¸] body ë°”ë¡œ ë°‘ì˜ ìì‹ë“¤ ì¤‘ í—¤ë”ê°€ ì•„ë‹Œ ê²ƒë“¤ì„ ìˆ¨ê¹ë‹ˆë‹¤.
              // ë§Œì•½ í—¤ë”ê°€ div ë“±ìœ¼ë¡œ ê°ì‹¸ì ¸ ìˆë‹¤ë©´ ê·¸ divì—ë„ í´ë˜ìŠ¤ë¥¼ ì£¼ì–´ì•¼ ì•ˆ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤.
              '  body > *:not(header):not(.authenticated-header):not(.custom-header):not(script):not(style) { ' +
              '    opacity: 0 !important; visibility: hidden !important; ' +
              '  }' +

              '  .authenticated-header, .custom-header {' +
              '    background-color: #121212 !important;' +
              '    border-bottom: 1px solid #2d2d2d !important;' +
              '    display: flex !important;' +
              '    opacity: 1 !important; visibility: visible !important;' +
              '  }' +
              '  .authenticated-header *, .custom-header * { color: #FFFFFF !important; border-color: #2d2d2d !important; }' +
              '</style>'
            );

            // ğŸŒŸ [ì¶”ê°€] ë§í† ë¥¼ ë²—ê¸°ëŠ” 'íƒ€ì´ë¨¸' (DOMì´ ë¡œë“œë˜ë©´ 0.05ì´ˆ ë’¤ì— ìˆ¨ê¹€ í•´ì œ)
            window.addEventListener('DOMContentLoaded', function () {
              setTimeout(function () {
                const flickerStyle = document.getElementById('anti-flicker-css');
                if (flickerStyle) {
                  // ë¶€ë“œëŸ½ê²Œ ë‚˜íƒ€ë‚˜ê²Œ í•˜ê³  ì‹¶ë‹¤ë©´ ìŠ¤íƒ€ì¼ì„ ì§€ìš°ê¸° ì „ì— opacityë¥¼ 1ë¡œ ì¤„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
                  flickerStyle.remove();
                }
              }, 50); // 0.05ì´ˆì˜ ì°°ë‚˜ ë’¤ì— ë³¸ë¬¸ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
            });
          }

          window.kumoMsgs = {
            scheduleTitle: /*[[#{main.calendar.schedule_detail}]]*/ ' ì¼ì •',
            noSchedule: /*[[#{main.calendar.no_schedule}]]*/ 'ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.'
          };
        })();
        /* ]]> */
    </script>

    <!-- ë‚˜ë¨¸ì§€ í—¤ë” ë¡œì§ì€ ì™¸ë¶€ JSë¡œ ë¶„ë¦¬ -->
    <script th:src="@{/js/RecruiterFragments/recruiterHeader.js}"></script>
  </div>
</html>
