<!doctype html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <div th:fragment="headerFragment">
    <header class="authenticated-header">
      <link
        rel="stylesheet"
        th:href="@{/css/RecruiterFragments/RecruiterHeader.css}"
        sec:authorize="isAuthenticated()"
      />

      <a th:href="@{/Recruiter/Main}" class="logo">
        <img
          th:src="@{/images/recruiter/recruiterLogo.png}"
          alt="KUMO"
          style="height: 40px;"
        />
      </a>

      <nav>
        <ul class="nav-menu">
          <li class="icon-btn notification-container" id="notifyBtn">
            <i class="fa-regular fa-bell"></i>
            <span class="notify-badge" style="display: none;">0</span>

            <div class="notify-dropdown" id="notifyMenu">
              <div class="notify-header">
                <span th:text="#{header.notifications}">알림</span>
                <div class="header-buttons">
                  <button
                    class="header-btn read-all"
                    id="markAllReadBtn"
                    th:text="#{header.mark_read}"
                  >
                    모두 읽음
                  </button>
                  <span class="divider">|</span>
                  <button
                    class="header-btn delete-all"
                    id="deleteAllBtn"
                    th:text="#{header.delete_all}"
                  >
                    전체 삭제
                  </button>
                </div>
              </div>

              <div class="notify-body" id="notifyList">
                <div
                  class="notify-empty"
                  id="notifyEmpty"
                  style="display: none;"
                >
                  <i class="fa-regular fa-bell-slash"></i>
                  <p th:text="#{notification.empty}">새로운 알림이 없습니다.</p>
                </div>
              </div>

              <div
                class="notify-footer"
                id="expandBtn"
                th:data-more="#{notification.more}"
                th:data-fold="#{notification.fold}"
              >
                <span th:text="#{notification.more}">더 보기</span>
                <i class="fa-solid fa-chevron-down"></i>
              </div>
            </div>
          </li>

          <li class="icon-btn lang-container" id="langBtn">
            <i class="fa-solid fa-globe"></i>
            <div class="lang-dropdown" id="langMenu">
              <a href="javascript:changeLang('ko')" class="lang-item">한국어</a>
              <a href="javascript:changeLang('ja')" class="lang-item">日本語</a>
            </div>
          </li>

          <li class="icon-btn" id="darkModeBtn">
            <i class="fa-regular fa-sun" id="darkModeIcon"></i>
          </li>

          <li class="profile-container" id="profileBtn">
            <div class="profile-circle">
              <img
                th:src="${user?.profileImage}"
                alt="Profile"
                class="user-avatar"
                id="profilePreview"
                th:if="${user?.profileImage != null}"
              />
              <i
                class="bi bi-person-circle"
                id="defaultIcon"
                th:unless="${user?.profileImage != null}"
              ></i>
            </div>

            <div class="profile-dropdown" id="profileMenu">
              <div class="profile-info">
                <span
                  class="user-name"
                  th:text="${#authentication.principal.nickname}"
                  >User</span
                >
                <span class="user-email" th:text="${#authentication.name}"
                  >email@test.com</span
                >
              </div>
              <hr />
              <a th:href="@{/Recruiter/MyPage}" class="profile-item">
                <i class="fa-regular fa-user"></i>
                <span th:text="#{profile.mypage}">마이페이지</span>
              </a>
              <a th:href="@{/Recruiter/Settings}" class="profile-item">
                <i class="fa-solid fa-gear"></i>
                <span th:text="#{profile.settings}">설정</span>
              </a>
              <hr />
              <a th:href="@{/logout}" class="profile-item logout">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span th:text="#{profile.logout}">로그아웃</span>
              </a>
            </div>
          </li>
        </ul>
      </nav>
    </header>

    <!-- ============================================================
         다크모드 깜빡임 방지 스크립트 (인라인 유지 필수)
         ============================================================ -->
    <script th:inline="javascript">
      /* <![CDATA[ */
      (function() {
          if ('scrollRestoration' in history) history.scrollRestoration = 'manual';

          // 깜빡임 방지 (즉시 실행)
          document.write('<style id="prevent-load-transition">body { transition: none !important; }</style>');
          const theme = localStorage.getItem('theme');
          if (theme === 'dark') {
              const root = document.documentElement;
              root.classList.add('dark-mode');
              root.style.cssText = 'background-color: #121212 !important; color: #FFFFFF !important;';
              document.write(
                  '<style id="page-transition-style">' +
                  '  html, body { background-color: #121212 !important; opacity: 0 !important; visibility: hidden !important; }' +

                  '  .authenticated-header, .custom-header {' +
                  '    background-color: #121212 !important;' +
                  '    border-bottom-color: #2d2d2d !important;' +
                  '    opacity: 0 !important;' +
                  '    visibility: hidden !important;' +
                  '  }' +

                  '  .sidebar-container {' +
                  '    background-color: #1e1e1e !important;' +
                  '    border-right-color: #333 !important;' +
                  '  }' +

                  '  .nav-item { color: #555 !important; }' +
                  '  .nav-item span { color: #ccc !important; }' +

                  '  .nav-item.active {' +
                  '    background-color: #2a3441 !important;' +
                  '    color: #7db4e6 !important;' +
                  '    border-left-color: #7db4e6 !important;' +
                  '  }' +
                  '  .nav-item.active span { color: #7db4e6 !important; }' +

                  '  .logout-btn {' +
                  '    background-color: #2d1f1f !important;' +
                  '    color: #ff6b6b !important;' +
                  '    border-left-color: #ff6b6b !important;' +
                  '  }' +
                  '  .logout-btn span { color: #ff6b6b !important; }' +
                  '</style>'
              );
          }

          // 달력 등 JS에서 사용하는 번역 데이터
          window.kumoMsgs = {
              scheduleTitle: /*[[#{main.calendar.schedule_detail}]]*/ ' 일정',
              noSchedule: /*[[#{main.calendar.no_schedule}]]*/ '일정이 없습니다.'
          };
      })();
      /* ]]> */
    </script>

    <!-- 나머지 헤더 로직은 외부 JS로 분리 -->
    <script th:src="@{/js/RecruiterFragments/recruiterHeader.js}"></script>
  </div>
</html>
