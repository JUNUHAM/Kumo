<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>KUMO RECRUITER - 내 계정</title>
    <script th:src="@{/js/recruiter/main.js}"></script>
    <script th:src="@{/js/recruiter/recruiterHeader.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" th:href="@{/css/recruiter/recruiterHeader.css}" />
    <link
      rel="stylesheet"
      th:href="@{/css/NonLoginFragments/NonLoginFooter.css}"
    />
    <link rel="stylesheet" th:href="@{/css/recruiter/sidebar.css}" />
    <link rel="stylesheet" th:href="@{/css/recruiter/main.css}" />
    <link rel="stylesheet" th:href="@{/css/recruiter/settings.css}" />
    <link rel="stylesheet" th:href="@{/css/recruiter/dark-theme.css}" />
  </head>
  <body>
    <header
      th:replace="~{recruiterView/fragments/recruiterHeader :: headerFragment}"
    ></header>

    <div class="dashboard-wrapper">
      <div
        th:replace="~{recruiterView/fragments/sidebar :: sidebarFragment}"
      ></div>

      <div class="main-container" style="margin-right: 0;">
        <main class="content-body">
          <div class="settings-container">
            <div class="content-header">
              <h2 class="settings-title" th:text="#{sidebar.menu.settings}">내 계정</h2>
            </div>
        
            <div class="profile-section">
              <div class="profile-photo-area">
                <div class="img-wrapper" id="profileContainer">
                  <img th:src="${user.profileImage ?: '/images/common/default_profile.png'}" id="profilePreview" alt="Profile"
                    class="profile-img-lg">
                </div>
                <input type="file" id="profileInput" accept="image/*" style="display: none;" />
                <button type="button" class="btn-upload-photo" id="uploadBtn" th:text="#{set.btn.upload}">프로필 사진 업로드</button>
              </div>
        
              <div class="info-list">
                <div class="info-row">
                  <span class="label" th:text="#{set.label.name}">이름</span>
                  <span class="value" th:text="${fullName}">이름 데이터</span>
                </div>
        
                <div class="info-row">
                  <span class="label" th:text="#{join.label.birth}">생년월일</span>
                  <span class="value">
                    <span th:text="${#temporals.format(user.birthDate, 'yyyy / MM / dd')}">1990 / 01 / 01</span>
                    <span class="age-suffix" th:text="#{set.label.age_suffix(${age})}">( 만 40세 )</span>
                  </span>
                </div>
        
                <div class="info-row">
                  <span class="label" th:text="#{join.label.nickname}">닉네임</span>
                  <span class="value" th:text="${user.nickname}">닉네임 데이터</span>
                </div>
        
                <div class="info-row">
                  <span class="label" th:text="#{join.label.email}">이메일</span>
                  <span class="value" th:text="${user.email}">user@kumo.io</span>
                </div>
        
                <div class="info-row">
                  <span class="label" th:text="#{join.label.address}">주소</span>
                  <span class="value" th:text="${user.addressMain + ' ' + user.addressDetail}">주소 데이터</span>
                </div>
        
                <div class="info-row align-items-center">
                  <span class="label">LINE 연동</span>
                  <label class="switch">
                    <input type="checkbox" class="sns-toggle" th:checked="${user.socialProvider == 'LINE'}">
                    <span class="slider round"></span>
                  </label>
                </div>
                
                <div class="info-row align-items-center">
                  <span class="label">Google 연동</span>
                  <label class="switch">
                    <input type="checkbox" class="sns-toggle" th:checked="${user.socialProvider == 'GOOGLE'}">
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>
        
              <div class="action-buttons">
                <button type="button" class="btn-quit" th:text="#{set.btn.quit}">회원 탈퇴</button>
                <a th:href="@{/Recruiter/ProfileEdit}" class="btn-edit" th:text="#{set.btn.edit}">회원정보 수정</a>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script>
            document.addEventListener('DOMContentLoaded', function() {
          const uploadBtn = document.getElementById('uploadBtn');
          const profileInput = document.getElementById('profileInput');
          const profilePreview = document.getElementById('profilePreview');

          // 1. 버튼 클릭 시 숨겨진 input 클릭
          uploadBtn.onclick = () => profileInput.click();

          // 2. 파일이 선택되면 서버로 즉시 전송
          profileInput.onchange = function() {
              const file = profileInput.files[0];
              if (!file) return;

              const formData = new FormData();
              formData.append("profileImage", file);

              fetch("/Recruiter/UploadProfile", {
                  method: "POST",
                  body: formData
                  // Spring Security를 쓰고 계시다면 CSRF 토큰을 헤더에 넣어야 할 수도 있습니다.
              })
              .then(response => response.json())
              .then(data => {
                  if (data.success) {
                      // 성공 시 이미지 즉시 교체
                      location.reload(); // 가장 확실한 방법
                  } else {
                      alert("업로드 실패: " + data.message);
                  }
              })
              .catch(error => console.error("Error:", error));
          };
      });

      document.addEventListener('DOMContentLoaded', function () {
          const snsToggles = document.querySelectorAll('.sns-toggle');

          snsToggles.forEach(toggle => {
            toggle.addEventListener('click', function (e) {
              // 1. 체크박스 상태 변경 방지 (서버 연동 전까지 고정)
              e.preventDefault();

              // 2. 다크모드 여부 확인 (사장님 dark-theme.css 대응)
              const isDark = document.documentElement.classList.contains('dark-mode');

              // 3. Seeker 감성의 SweetAlert2 띄우기
              Swal.fire({
                title: 'Service Notice',
                text: '아직 서비스 준비 중입니다.', // th:text="#{msg.not.service}" 대신 직접 입력 가능
                icon: 'info',
                confirmButtonText: '확인',
                confirmButtonColor: '#7abaff',
                background: isDark ? '#2b2b2b' : '#fff',
                color: isDark ? '#fff' : '#333'
              });
            });
          });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
