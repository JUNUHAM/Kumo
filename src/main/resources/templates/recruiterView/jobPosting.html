<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>KUMO RECRUITER - 공고 등록</title>
  <script th:src="@{/js/recruiter/recruiterHeader.js}"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link rel="stylesheet" th:href="@{/css/recruiter/recruiterHeader.css}" />
  <link rel="stylesheet" th:href="@{/css/NonLoginFragments/NonLoginFooter.css}" />
  <link rel="stylesheet" th:href="@{/css/recruiter/sidebar.css}" />
  <link rel="stylesheet" th:href="@{/css/recruiter/main.css}" />
  <link rel="stylesheet" th:href="@{/css/recruiter/jobPosting.css}" />
  <link rel="stylesheet" th:href="@{/css/recruiter/companyInfo.css}" />
  <link rel="stylesheet" th:href="@{/css/recruiter/dark-theme.css}" />
  <link rel="icon"
    href="data:;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==">
</head>

<body>
  <header th:replace="~{recruiterView/fragments/recruiterHeader :: headerFragment}"></header>

  <div class="dashboard-wrapper">
    <div th:replace="~{recruiterView/fragments/sidebar :: sidebarFragment}"></div>

    <div class="main-container">
      <main class="content-body">
        <div class="posting-card">
          <h2 class="posting-title" th:text="#{post.title}">공고 등록</h2>
    
          <form th:action="@{/Recruiter/JobPosting}" method="post" enctype="multipart/form-data" id="jobPostForm">
    
            <div class="form-group mb-4">
              <label class="form-label" th:text="#{post.label.subject}">제목</label>
              <input type="text" name="title" class="form-control kumo-input" th:placeholder="#{post.placeholder.subject}"
                required />
            </div>
    
            <div class="row mb-4">
              <div class="col-md-6">
                <label class="form-label" th:text="#{post.label.task}">업무</label>
                <input type="text" name="position" class="form-control kumo-input"
                  th:placeholder="#{post.placeholder.task}" />
              </div>
              <div class="col-md-6">
                <label class="form-label" th:text="#{post.label.task_detail}">업무 상세</label>
                <input type="text" name="positionDetail" class="form-control kumo-input"
                  th:placeholder="#{post.placeholder.task_detail}" />
              </div>
            </div>
    
            <div class="form-group mb-4">
              <label class="form-label" th:text="#{post.label.contact}">연락처</label>
              <input type="text" name="contactPhone" class="form-control kumo-input"
                th:placeholder="#{post.placeholder.contact}" required />
            </div>
    
            <div class="form-group mb-4">
              <label class="form-label" th:text="#{post.label.wage}">급여</label>
              <div class="d-flex align-items-center gap-2">
                <select name="salaryType" class="form-select kumo-input-sm" style="width: 100px;">
                  <option value="HOURLY" th:text="#{post.wage.hourly}">시급</option>
                  <option value="DAILY" th:text="#{post.wage.daily}">일급</option>
                  <option value="MONTHLY" th:text="#{post.wage.monthly}">월급</option>
                  <option value="SALARY" th:text="#{post.wage.yearly}">연봉</option>
                </select>
                <div class="position-relative flex-grow-1">
                  <input type="number" name="salaryAmount" class="form-control kumo-input" style="padding-right: 40px;" />
                  <span class="position-absolute end-0 top-50 translate-middle-y me-3 text-muted">円</span>
                </div>
              </div>
            </div>
            
            <div class="form-group mb-4">
              <label class="form-label" th:text="#{post.label.photo}">사진 업로드</label>
              <div class="upload-container" id="uploadContainer">
                <label for="file-upload" class="upload-btn">
                  <i class="bi bi-plus-circle-fill"></i>
                  <input type="file" id="file-upload" name="images" hidden multiple accept="image/*" />
                </label>
              </div>
              <div id="previewArea" class="d-flex flex-wrap gap-2 mt-2"></div>
            </div>
    
            <div class="form-group mb-4">
              <label class="form-label" th:text="#{post.label.select_biz}">등록 회사 선택</label>
              <div class="company-selection-box">
                <div class="input-group">
                  <span class="input-group-text bg-light border-0">
                    <i class="bi bi-building text-primary"></i>
                  </span>
                  <select name="companyId" id="selectedCompanyId" class="form-select kumo-input-sm border-0" required>
                    <option value="" disabled th:selected="${#lists.isEmpty(companies)}" th:text="#{post.guide.select_biz}">
                      회사를 선택해주세요</option>
                    <option th:each="company : ${companies}" th:value="${company.companyId}" th:text="${company.bizName}">
                      회사이름
                    </option>
                  </select>
                  <a th:href="@{/Recruiter/CompanyInfo}"
                    class="btn btn-outline-secondary kumo-btn-outline d-flex align-items-center">
                    <i class="bi bi-plus-lg me-1"></i> <span th:text="#{biz.btn.manage_short}">관리</span>
                  </a>
                </div>
                <small class="text-muted mt-2 d-block" th:if="${#lists.isEmpty(companies)}">
                  * 등록된 회사가 없습니다. 먼저 회사를 등록해주세요.
                </small>
              </div>
            </div>

            <input type="hidden" name="companyId" id="companyId">
    
            <div class="form-group mb-5">
              <label class="form-label" th:text="#{post.label.detail}">상세정보</label>
              <textarea name="description" class="form-control kumo-input" rows="6"
                th:placeholder="#{post.placeholder.detail}"></textarea>
            </div>
    
            <div class="text-center mb-5">
              <button type="submit" class="btn btn-primary kumo-btn-submit" th:text="#{post.btn.submit}">
                등록
              </button>
            </div>
    
          </form>
        </div>
  </div>

  <script th:inline="javascript">
    /* <![CDATA[ */

    // 1. 마감일 hidden input 조합
    document.getElementById('jobPostForm').addEventListener('submit', function (e) {
      const y = document.getElementById('dl-year').value;
      const m = document.getElementById('dl-month').value.padStart(2, '0');
      const d = document.getElementById('dl-day').value.padStart(2, '0');
      const t = document.getElementById('dl-time').value;

      if (y && m && d) {
        const time = t ? 'T' + t : '';
        document.getElementById('hiddenDeadline').value = `${y}-${m}-${d}${time}`;
      }
    });

    // 2. 회사 선택
    function selectCompanyForPost(companyId, btnElement) {
      document.getElementById('selectedCompanyId').value = companyId;
      document.querySelectorAll('#companySelectTabs .nav-pill')
        .forEach(tab => tab.classList.remove('active'));
      if (btnElement) btnElement.classList.add('active');
    }

    // 3. 이미지 미리보기
    document.getElementById('file-upload').addEventListener('change', function () {
      const previewArea = document.getElementById('previewArea');
      previewArea.innerHTML = '';

      Array.from(this.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function (e) {
          const wrapper = document.createElement('div');
          wrapper.style.cssText = 'position:relative; width:80px; height:80px;';

          const img = document.createElement('img');
          img.src = e.target.result;
          img.style.cssText = 'width:80px; height:80px; object-fit:cover; border-radius:10px; border:2px solid #e5e8eb;';

          wrapper.appendChild(img);
          previewArea.appendChild(wrapper);
        };
        reader.readAsDataURL(file);
      });
    });

    /* ]]> */
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>