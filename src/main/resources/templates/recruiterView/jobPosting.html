<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>KUMO RECRUITER - 공고 등록</title>
    <script th:src="@{/js/recruiter/main.js}"></script>
    <script th:src="@{/js/recruiter/recruiterHeader.js}"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" th:href="@{/css/recruiter/recruiterHeader.css}" />
    <link
      rel="stylesheet"
      th:href="@{/css/NonLoginFragments/NonLoginFooter.css}"
    />
    <link rel="stylesheet" th:href="@{/css/recruiter/sidebar.css}" />
    <link rel="stylesheet" th:href="@{/css/recruiter/main.css}" />
    <link rel="stylesheet" th:href="@{/css/recruiter/jobPosting.css}" />
    <link rel="stylesheet" th:href="@{/css/recruiter/companyInfo.css}" />
    <link rel="stylesheet" th:href="@{/css/recruiter/dark-theme.css}" />
  </head>
  <body>
    <header
      th:replace="~{recruiterView/fragments/recruiterHeader :: headerFragment}"
    ></header>

    <div class="dashboard-wrapper">
      <div
        th:replace="~{recruiterView/fragments/sidebar :: sidebarFragment}"
      ></div>

      <div class="main-container">
        <main class="content-body">
          <div class="posting-card">
            <h2 class="posting-title" th:text="#{post.title}">공고 등록</h2>

            <form
              action="/Recruiter/JobPosting"
              method="post"
              enctype="multipart/form-data"
              id="jobPostForm"
            >
              <div class="form-group mb-4">
                <label class="form-label" th:text="#{post.label.subject}"
                  >제목</label
                >
                <input
                  type="text"
                  name="title"
                  class="form-control kumo-input"
                  placeholder="구인글 제목을 입력해주세요."
                  required
                />
              </div>

              <div class="row mb-4">
                <div class="col-md-6">
                  <label class="form-label" th:text="#{post.label.task}"
                    >업무</label
                  >
                  <input
                    type="text"
                    name="position"
                    class="form-control kumo-input"
                    placeholder="직책을 입력해주세요."
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label" th:text="#{post.label.task_detail}"
                    >업무 상세</label
                  >
                  <input
                    type="text"
                    name="positionDetail"
                    class="form-control kumo-input"
                    placeholder="상세 업무내용을 입력해주세요."
                  />
                </div>
              </div>

              <div class="form-group mb-4">
                <label class="form-label" th:text="#{post.label.deadline}"
                  >마감일</label
                >
                <div class="d-flex align-items-center gap-2 flex-nowrap">
                  <input
                    type="number"
                    id="dl-year"
                    class="form-control kumo-input-sm"
                    style="width: 85px;"
                    placeholder="YYYY"
                  />
                  <input
                    type="number"
                    id="dl-month"
                    class="form-control kumo-input-sm"
                    style="width: 65px;"
                    placeholder="MM"
                  />
                  <input
                    type="number"
                    id="dl-day"
                    class="form-control kumo-input-sm"
                    style="width: 65px;"
                    placeholder="DD"
                  />
                  <input
                    type="time"
                    id="dl-time"
                    class="form-control kumo-input-sm"
                    style="width: 110px;"
                  />
                  <span
                    class="fw-bold text-nowrap"
                    style="color: #4a90e2; min-width: 40px;"
                    th:text="#{post.label.until}"
                    >까지</span
                  >
                </div>
                <input type="hidden" name="deadline" id="hiddenDeadline" />
              </div>

              <div class="form-group mb-4">
                <label class="form-label" th:text="#{post.label.wage}"
                  >급여</label
                >
                <div class="d-flex align-items-center gap-2">
                  <select
                    name="salaryType"
                    class="form-select kumo-input-sm"
                    style="width: 100px;"
                  >
                    <option value="HOURLY" th:text="#{post.wage.hourly}">
                      시급
                    </option>
                    <option value="DAILY" th:text="#{post.wage.daily}">
                      일급
                    </option>
                    <option value="MONTHLY" th:text="#{post.wage.monthly}">
                      월급
                    </option>
                    <option value="SALARY" th:text="#{post.wage.yearly}">
                      연봉
                    </option>
                  </select>
                  <div class="position-relative flex-grow-1">
                    <input
                      type="number"
                      name="salaryAmount"
                      class="form-control kumo-input"
                      style="padding-right: 40px;"
                    />
                    <span
                      class="position-absolute end-0 top-50 translate-middle-y me-3 text-muted"
                      >円</span
                    >
                  </div>
                </div>
              </div>

              <div class="form-group mb-4">
                <label class="form-label" th:text="#{post.label.photo}"
                  >사진 업로드</label
                >
                <div class="upload-container">
                  <label for="file-upload" class="upload-btn">
                    <i class="bi bi-plus-circle-fill"></i>
                    <input
                      type="file"
                      id="file-upload"
                      name="images"
                      hidden
                      multiple
                      accept="image/*"
                    />
                  </label>
                </div>
              </div>

              <div class="form-group mb-4">
                <label class="form-label" th:text="#{post.label.select_biz}"
                  >등록 회사 선택</label
                >
                <div class="company-selection-wrapper">
                  <div class="nav-pills-wrapper" id="companySelectTabs">
                    <button
                      th:each="company, stat : ${companies}"
                      type="button"
                      class="nav-pill"
                      th:classappend="${stat.first} ? 'active' : ''"
                      th:onclick="|selectCompanyForPost(${company.companyId}, this)|"
                      th:text="${company.bizName}"
                    >
                      회사이름 (자동으로 바뀜)
                    </button>

                    <a
                      th:href="@{/Recruiter/CompanyInfo}"
                      class="nav-pill-link"
                    >
                      <i class="bi bi-gear-fill me-1"></i>
                      <span th:text="#{biz.btn.manage_short}">회사 관리</span>
                    </a>
                  </div>

                  <input
                    type="hidden"
                    name="companyId"
                    id="selectedCompanyId"
                    th:value="${not #lists.isEmpty(companies)} ? ${companies[0].companyId} : ''"
                  />
                </div>
              </div>

              <div class="form-group mb-5">
                <label class="form-label" th:text="#{post.label.detail}"
                  >상세정보</label
                >
                <textarea
                  name="description"
                  class="form-control kumo-input"
                  rows="6"
                  placeholder="상세 내용을 입력해주세요."
                ></textarea>
              </div>

              <div class="text-center mb-5">
                <button
                  type="submit"
                  class="btn btn-primary kumo-btn-submit"
                  th:text="#{post.btn.submit}"
                >
                  등록
                </button>
              </div>
            </form>
          </div>
          <footer
            th:replace="~{NonLoginFragments/NonLoginFooter :: footerFragment}"
          ></footer>
        </main>
      </div>
    </div>
    <script th:inline="javascript">
                  document.getElementById('jobPostForm').addEventListener('submit', function(e) {
                    const y = document.getElementById('dl-year').value;
                    const m = document.getElementById('dl-month').value.padStart(2, '0');
                    const d = document.getElementById('dl-day').value.padStart(2, '0');

                    // 연, 월, 일이 모두 입력되었을 때만 합쳐서 hidden input에 넣음 (포맷: YYYY-MM-DD)
                    if(y && m && d) {
                      document.getElementById('hiddenDeadline').value = `${y}-${m}-${d}`;
                    }
                  });

                    // 🌟 회사 선택 시 실행되는 함수
      function selectCompanyForPost(companyId, btnElement) {
          // 1. 숨겨진 input 태그의 값을 클릭한 회사의 ID로 변경
          document.getElementById('selectedCompanyId').value = companyId;

          // 2. 모든 버튼의 파란색(active)을 뺌
          const tabs = document.getElementById('companySelectTabs').querySelectorAll('.nav-pill');
          tabs.forEach(tab => tab.classList.remove('active'));

          // 3. 방금 클릭한 버튼만 파란색으로 칠함
          if(btnElement) {
              btnElement.classList.add('active');
          }
      }
    </script>
  </body>
</html>
