<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
	<meta charset="UTF-8">
	<title>KUMO - ì§€ë„ ê²€ìƒ‰</title>


    <link rel="stylesheet" th:href="@{/css/mainView/main.css}">
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	
	<script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script th:src="@{/js/mapStyle/mapStyles.js}"></script>
	<script th:src="@{/js/geo/osaka.js}"></script>
	<script th:src="@{/js/geo/tokyo.js}"></script>
	<script th:src="@{/js/geo/osakaCity.js}"></script>
	<script th:src="@{/js/mainView/main.js}"></script>
</head>
<body>
<div class="map-header-wrapper">
    <div th:replace="~{NonLoginFragments/NonLoginHeader :: headerFragment}"
         sec:authorize="!isAuthenticated()"></div>

    <div th:replace="~{AuthenticatedFragments/AuthenticatedHeader :: headerFragment}"
         sec:authorize="isAuthenticated()"></div>
</div>

<div class="map-container">
	
	<div id="map"></div>
	
	<div class="map-search-floating">
		<div class="search-bar">
			<select id="regionSelect" onchange="MapManager.changeRegion(this.value)">
				<option value="tokyo" th:text="#{map.region.tokyo}">ë„ì¿„</option>
				<option value="osaka" th:text="#{map.region.osaka}">ì˜¤ì‚¬ì¹´</option>
			</select>
			<div class="divider"></div>
			
			<i class="fa-solid fa-bars menu-icon"></i>
			<input type="text" id="keywordInput" placeholder="ê²€ìƒ‰ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”."
			       onkeyup="if(event.key === 'Enter') JobService.searchJobs()">
			<button onclick="JobService.searchJobs()">
				<i class="fa-solid fa-magnifying-glass"></i>
			</button>
		</div>
	</div>
	
	<div class="map-bottom-nav">
		<div class="nav-box">
			<button class="nav-item active" data-tab="nearby">
				<div class="icon-box"><i class="fa-solid fa-location-dot"></i></div>
				<span th:text="#{nav.nearby}">ì£¼ë³€ ì¼ìë¦¬</span>
			</button>
			
			<th:block sec:authorize="isAuthenticated()">
				<button class="nav-item" data-tab="saved">
					<div class="icon-box"><i class="fa-regular fa-bookmark"></i></div>
					<span th:text="#{nav.saved}">ì €ì¥ëœ ê³µê³ </span>
				</button>
			</th:block>
			
			<button class="nav-item" data-tab="recent">
				<div class="icon-box"><i class="fa-regular fa-clock"></i></div>
				<span th:text="#{nav.recent}">ìµœê·¼ ë³¸ ê³µê³ </span>
			</button>
			
			<th:block sec:authorize="isAuthenticated()">
				<button class="nav-item" data-tab="chat">
					<div class="icon-box">
						<i class="fa-regular fa-comments"></i>
						<span class="badge-dot" style="display:none;">N</span>
					</div>
					<span th:text="#{nav.chat}">ì±„íŒ…</span>
				</button>
			</th:block>
		</div>
	</div>
	<div id="jobDetailCard" class="floating-card">
		<button type="button" class="btn-close-card">Ã—</button>
		
		<div class="card-header-section">
			<div class="profile-info">
				<div id="card-company" class="company-name">ABC Company</div>
				<div id="card-manager" class="manager-name">ç”°ä¸­ éƒ¨é•·</div>
			</div>
		</div>

        <div class="card-image-wrapper">
            <img id="card-img" src="" alt="Office View"
                 onerror="this.src='https://placehold.co/300'">
        </div>
		
		<div class="card-body-section">
			<h3 id="card-title" class="job-title">ë¹„ì„œ êµ¬í•©ë‹ˆë‹¤</h3>
			<p class="job-address">ì£¼ì†Œ: <span id="card-address">...</span></p>
			<p class="job-phone" id="card-phone">010-xxxx-xxxx</p>
		</div>
		
		<div class="card-footer-section">
			<button class="btn-outline">ì°œí•˜ê¸°</button>
			<button id="btn-detail" class="btn-primary-custom">ìì„¸íˆ ë³´ê¸°</button>
		</div>
	</div>
</div>

<div class="bottom-sheet" id="bottomSheet">
	
	<div class="sheet-handle">
		<div class="handle-bar"></div>
	</div>
	
	<div class="sheet-content">
		<h2 style="padding: 0 10px; font-size: 18px;">êµ¬ì§ ì •ë³´ ë¦¬ìŠ¤íŠ¸ ğŸ“‹</h2>
		
		<div class="table-wrapper">
			<table class="job-table">
				<thead>
				<tr id="tableHeader">
					<th>ì œëª©</th>
					<th>ìƒí˜¸ëª…</th>
					<th>ê·¼ë¬´ì§€</th>
					<th>ê¸‰ì—¬</th>
					<th>ì—°ë½ì²˜</th>
					<th>ë‹´ë‹¹ì</th>
					<th>ê´€ë¦¬</th>
				</tr>
				</thead>
				<tbody id="listBody">
				<tr><td colspan="7" class="msg-box">ì§€ë„ë¥¼ ì›€ì§ì´ë©´ ê³µê³ ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤...</td></tr>
				</tbody>
			</table>
		</div>
	</div>
</div>
<script th:inline="javascript">
	const MapMessages = {
		loading: /*[[#{js.map.msg.loading}]]*/ 'ë°ì´í„° ë¡œë”© ì¤‘...',
		loadFail: /*[[#{js.map.msg.load_fail}]]*/ 'ë¡œë”© ì‹¤íŒ¨',
		emptyJob: /*[[#{js.map.msg.empty_job}]]*/ 'ê³µê³  ì—†ìŒ',
		savedFail: /*[[#{js.map.msg.saved_fail}]]*/ 'ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨',
		fbTitle: /*[[#{js.map.fallback.title}]]*/ 'ì œëª© ì—†ìŒ',
		fbCompany: /*[[#{js.map.fallback.company}]]*/ 'íšŒì‚¬ëª… ë¯¸ì •',
		fbWage: /*[[#{js.map.fallback.wage}]]*/ 'í˜‘ì˜',
		fbManager: /*[[#{js.map.fallback.manager}]]*/ 'ë‹´ë‹¹ì',
		fbTime: /*[[#{js.map.fallback.time}]]*/ 'ë°©ê¸ˆ ì „',
		badgeRecruit: /*[[#{js.map.badge.recruit}]]*/ 'êµ¬ì¸ì¤‘',
		badgeUrgent: /*[[#{js.map.badge.urgent}]]*/ 'ê¸‰êµ¬',
		btnSave: /*[[#{js.map.btn.save}]]*/ 'ì°œ',
		btnSaveCard: /*[[#{js.map.btn.save_card}]]*/ 'ì°œí•˜ê¸°',
		btnDetail: /*[[#{js.map.btn.detail}]]*/ 'ìƒì„¸',
		btnDetailCard: /*[[#{js.map.btn.detail_card}]]*/ 'ìì„¸íˆ ë³´ê¸°',
		labelAddress: /*[[#{js.map.label.address}]]*/ 'ì£¼ì†Œ: ',
		table: [
			/*[[#{js.map.table.title}]]*/ 'ì œëª©',
			/*[[#{js.map.table.company}]]*/ 'ìƒí˜¸ëª…',
			/*[[#{js.map.table.location}]]*/ 'ê·¼ë¬´ì§€',
			/*[[#{js.map.table.wage}]]*/ 'ê¸‰ì—¬',
			/*[[#{js.map.table.contact}]]*/ 'ì—°ë½ì²˜',
			/*[[#{js.map.table.manager}]]*/ 'ë‹´ë‹¹ì',
			/*[[#{js.map.table.manage}]]*/ 'ê´€ë¦¬'
		]
	};
</script>

<script th:src="@{'https://maps.googleapis.com/maps/api/js?key=' + ${googleMapsKey} + '&callback=initMap&loading=async'}"
        async defer></script>
</body>
</html>