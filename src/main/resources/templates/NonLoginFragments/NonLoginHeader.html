<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="headerFragment">
    <script th:inline="javascript">
        /* <![CDATA[ */
        (function() {
          if ('scrollRestoration' in history) history.scrollRestoration = 'manual';

          // ★ [핵심 1] 로딩 중 애니메이션 기절시키기!
          // 브라우저가 화면을 그리기 전에 transition을 강제로 꺼버립니다.
          document.write('<style id="prevent-load-transition">body { transition: none !important; }</style>');

          const theme = localStorage.getItem('theme');
          if (theme === 'dark') {
            const root = document.documentElement;
            root.classList.add('dark-mode');

            root.style.cssText = 'background-color: #121212 !important; color: #ffffff !important;';

            // 혹시 모를 흰색 번쩍임을 잡는 2차 방어선
            document.write(`
              <style id="page-transition-style">
                html, body { background-color: #121212 !important; opacity: 0 !important; visibility: hidden !important; }
              </style>
            `);
          }
        })();

        document.addEventListener("DOMContentLoaded", function() {
          const body = document.body;
          const html = document.documentElement;
          const theme = localStorage.getItem('theme');

          if (theme === 'dark') body.classList.add('dark-mode');

          requestAnimationFrame(() => {
            window.scrollTo(0, 0);
            body.style.opacity = '1';
            body.style.visibility = 'visible';

  // 1. 화면 표시: 0.05초 만에 빠르게 짠! 하고 보여줌 (답답함 방지)
        setTimeout(() => {
          const styleTag = document.getElementById('page-transition-style');
          if (styleTag) styleTag.remove();
        }, 50);

        // 2. 애니메이션 족쇄 해제: 0.4초(400ms) 뒤에 아주 넉넉하게 풀어줌
        // 브라우저가 다크모드 색칠을 100% 끝낸 확실한 타이밍에 애니메이션을 부활시킵니다.
        setTimeout(() => {
          const preventTransition = document.getElementById('prevent-load-transition');
          if (preventTransition) preventTransition.remove();
        }, 400);
          });

          // --- 이하 기존 로직 (다크모드 토글, 언어 변경 등) ---
          function setupMenu(btnId, menuId) {
            const btn = document.getElementById(btnId);
            const menu = document.getElementById(menuId);
            if (btn && menu) {
              btn.onclick = (e) => { e.stopPropagation(); menu.classList.toggle('show'); };
              document.addEventListener('click', (e) => { if (!btn.contains(e.target)) menu.classList.remove('show'); });
            }
          }

          setupMenu('langBtn', 'langMenu');

          const toggleBtn = document.getElementById('darkModeBtn');
          const icon = document.getElementById('darkModeIcon');

          if (theme === 'dark' && icon) icon.classList.replace('fa-sun', 'fa-moon');

          if (toggleBtn) {
            toggleBtn.addEventListener('click', () => {
              const isDark = body.classList.toggle('dark-mode');
              html.classList.toggle('dark-mode');
              localStorage.setItem('theme', isDark ? 'dark' : 'light');
              if(icon) icon.classList.replace(isDark ? 'fa-sun' : 'fa-moon', isDark ? 'fa-moon' : 'fa-sun');

              if (!isDark) html.style.cssText = '';
            });
          }
        });

        window.changeLang = function(lang) {
            const url = new URL(window.location.href);
            url.searchParams.set('lang', lang);
            window.location.href = url.toString();
        };
        /* ]]> */
    </script>

    <header class="non-login-header">
        <a th:href="@{/}" class="logo">
            <img
                    th:src="@{/images/NonLogin/seekerLogo.png}"
                    alt="KUMO"
                    style="height: 40px;"
            />
        </a>

        <nav>
            <ul class="nav-menu">
                <li>
                    <a th:href="@{/Info}" th:text="#{header.company}">회사 정보</a>
                </li>
                <li><a th:href="@{/login}" th:text="#{header.login}">로그인</a></li>

                <li class="icon-btn lang-container" id="langBtn">
                    <i class="fa-solid fa-globe"></i>
                    <div class="lang-dropdown" id="langMenu">
                        <a href="javascript:changeLang('ko')" class="lang-item">한국어</a>
                        <a href="javascript:changeLang('ja')" class="lang-item">日本語</a>
                    </div>
                </li>

                <li class="icon-btn" id="darkModeBtn">
                    <i class="fa-regular fa-sun" id="darkModeIcon"></i>
                </li>
            </ul>
        </nav>
    </header>
</div>
</html>
