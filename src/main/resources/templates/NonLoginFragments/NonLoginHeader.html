<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <div th:fragment="headerFragment">
    <script th:inline="javascript">
        /* <![CDATA[ */

        // [1] 즉시 실행: DOM이 그려지기도 전에 배경색부터 검게 칠해버림
        (function() {
          // 스크롤 복원 방지
                // 테마 확인
        const theme = localStorage.getItem('theme');

        // 다크모드면? 브라우저가 딴짓하기 전에 배경색부터 칠해버림!
        if (theme === 'dark') {
          const root = document.documentElement;
          root.classList.add('dark-mode');
          root.style.setProperty('background-color', '#121212', 'important');
          root.style.setProperty('color', '#ffffff', 'important');
        }
      })();

          // --- [기능 로직: 다크모드 토글 & 언어 변경] ---

          // 1. 다크모드 토글
          const toggleBtn = document.getElementById('darkModeBtn');
          const icon = document.getElementById('darkModeIcon');

          // 아이콘 초기화
          if (theme === 'dark' && icon) icon.classList.replace('fa-sun', 'fa-moon');

          if (toggleBtn) {
            toggleBtn.addEventListener('click', () => {
              const isDark = body.classList.toggle('dark-mode');
              html.classList.toggle('dark-mode'); // html 태그도 같이 토글

              localStorage.setItem('theme', isDark ? 'dark' : 'light');

              if(icon) icon.classList.replace(isDark ? 'fa-sun' : 'fa-moon', isDark ? 'fa-moon' : 'fa-sun');

              // 버튼 클릭 시에는 배경색을 즉시 바꿈 (인라인 스타일 제어)
              if(isDark) {
                 html.style.setProperty('background-color', '#121212', 'important');
              } else {
                 html.style.removeProperty('background-color'); // 라이트모드는 CSS에게 맡김
                 html.style.backgroundColor = '#ffffff';
              }
            });
          }

          // 2. 언어 선택 드롭다운
          const langBtn = document.getElementById('langBtn');
          const langMenu = document.getElementById('langMenu');
          if (langBtn && langMenu) {
              langBtn.onclick = (e) => { e.stopPropagation(); langMenu.classList.toggle('show'); };
              document.addEventListener('click', (e) => { if (!langBtn.contains(e.target)) langMenu.classList.remove('show'); });
          }

        // 언어 변경 함수
        function changeLang(lang) {
            const url = new URL(window.location.href);
            url.searchParams.set('lang', lang);
            window.location.href = url.toString();
        }
        /* ]]> */
    </script>

    <header class="non-login-header">
        <a th:href="@{/}" class="logo">
            <img th:src="@{/images/NonLogin/seekerLogo.png}" alt="KUMO" style="height: 40px;">
        </a>
        <nav>
            <ul class="nav-menu">
                <li><a th:href="@{/info}" th:text="#{header.company}">회사 정보</a></li>

                <li><a th:href="@{/login}" th:text="#{header.login}">로그인</a></li>

                <li class="icon-btn lang-container" id="langBtn">
                    <i class="fa-solid fa-globe"></i>
                    <div class="lang-dropdown" id="langMenu">
                        <a href="javascript:changeLang('ko')" class="lang-item">한국어</a>
                        <a href="javascript:changeLang('ja')" class="lang-item">日本語</a>
                    </div>
                </li>

                <li class="icon-btn" id="darkModeBtn">
                    <i class="fa-regular fa-sun" id="darkModeIcon"></i>
                </li>
            </ul>
        </nav>
    </header>
  </div>
</html>